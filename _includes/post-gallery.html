{% unless page.gallery_assets_loaded %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0/dist/fancybox/fancybox.css">
<style>
  .post-gallery { columns: 3; column-gap: 8px; margin: 2rem 0; }
  .post-gallery .gallery-item { break-inside: avoid; margin-bottom: 8px; border-radius: 6px; overflow: hidden; cursor: pointer; transition: opacity 0.3s ease; }
  .post-gallery .gallery-item:hover { opacity: 0.85; }
  .post-gallery .gallery-item img { width: 100%; display: block; pointer-events: none; }
  .post-gallery-link { display: block; text-align: center; margin-top: 1rem; font-size: 0.95rem; opacity: 0.7; transition: opacity 0.2s; }
  .post-gallery-link:hover { opacity: 1; }
  
  @media (max-width: 576px) {
    .post-gallery { columns: 2; column-gap: 6px; }
    .post-gallery .gallery-item { margin-bottom: 6px; }
  }
  
  /* Prevent Chirpy from wrapping these images */
  .post-gallery .gallery-item a.popup,
  .post-gallery .gallery-item a.img-link { display: contents !important; pointer-events: none !important; }
</style>
<script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0/dist/fancybox/fancybox.umd.js"></script>
{% endunless %}
{% assign photo_list = include.photos | split: ',' %}
{% assign gallery_id = photo_list | first | slugify | append: '-' | append: photo_list.size %}
<div class="post-gallery" id="post-gallery-{{ gallery_id }}">
  {% for photo_entry in photo_list %}
    {% assign parts = photo_entry | split: '|' %}
    {% assign filename = parts[0] | strip %}
    {% assign caption = parts[1] | strip %}
    <div class="gallery-item"
         data-full="{{ include.cdn }}/full/{{ filename }}"
         data-caption="{{ caption }}">
      <img
        src="{{ include.cdn }}/thumbs/{{ filename }}"
        alt="{{ caption | default: 'Photo' }}"
        loading="lazy"
      >
    </div>
  {% endfor %}
</div>
{% if include.album_url %}
  <a href="{{ include.album_url }}" class="post-gallery-link">
    Browse all photos from this trip â†’
  </a>
{% endif %}
<script>
  (function() {
    var container = document.getElementById('post-gallery-{{ gallery_id }}');
    if (!container || container.dataset.init) return;
    container.dataset.init = 'true';
    var items = container.querySelectorAll('.gallery-item');
    var galleryData = [];
    items.forEach(function(item) {
      galleryData.push({
        src: item.getAttribute('data-full'),
        type: 'image'
      });
    });
    items.forEach(function(item, i) {
      item.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        Fancybox.show(galleryData, {
          startIndex: i,
          Toolbar: { display: { left: [], middle: [], right: ["close"] } },
          Thumbs: false,
          Slideshow: false,
          Images: { zoom: false }
        });
      });
    });
  })();
</script>